---
import fightersData from '@/data/fighters.json'

import PageLayout from '@/layouts/BaseLayout.astro'
import Breadcrumbs from '@/components/Breadcrumbs.astro'

export const prerender = true

// Organizar peleadores alfabéticamente
interface Fighter {
  id: number
  name: string
  slug: string
  division: string
  rank?: string
  record?: string
}

const fightersByLetter = (fightersData as Fighter[]).reduce(
  (acc, fighter) => {
    const firstLetter = fighter.name[0].toUpperCase()
    if (!acc[firstLetter]) {
      acc[firstLetter] = []
    }
    acc[firstLetter].push(fighter)
    return acc
  },
  {} as Record<string, Fighter[]>
)

// Ordenar cada grupo alfabéticamente
Object.keys(fightersByLetter).forEach((letter) => {
  fightersByLetter[letter].sort((a, b) => a.name.localeCompare(b.name))
})

const letters = Object.keys(fightersByLetter).sort()

const meta = {
  title: 'Índice Alfabético de Peleadores UFC | Quimbara',
  description: `Directorio alfabético completo de ${fightersData.length} peleadores de UFC. Encuentra rápidamente cualquier atleta por nombre.`
}

// Helper para imagen
const getFighterImg = (id: number) => `https://media.api-sports.io/mma/fighters/${id}.png`
---

<PageLayout {meta}>
  <!-- Breadcrumb -->
  <Breadcrumbs
    path={[
      { title: 'Inicio', link: '/' },
      { title: 'Peleadores', link: '/fighters/' },
      { title: 'Índice A-Z', link: '/fighters/az/' }
    ]}
  />

  <!-- Hero -->
  <section class='py-12 mb-12 text-center'>
    <div
      class='inline-block bg-quimbara-magenta/10 text-quimbara-magenta px-4 py-1 rounded-full text-sm font-bold uppercase tracking-wider mb-4 border border-quimbara-magenta/20'
    >
      Índice Alfabético
    </div>
    <h1 class='text-4xl md:text-6xl font-heading font-bold mb-4 text-quimbara-purple'>
      PELEADORES <span class='text-quimbara-magenta'>A-Z</span>
    </h1>
    <p class='text-lg text-quimbara-purple/70 max-w-3xl mx-auto'>
      Directorio completo de {fightersData.length} peleadores organizados alfabéticamente
    </p>
  </section>

  <!-- Navegación de Letras -->
  <nav
    class='sticky top-20 z-30 bg-quimbara-cream/95 backdrop-blur-sm border-y border-border py-4 mb-8 -mx-4 px-4 md:-mx-8 md:px-8'
  >
    <div class='flex flex-wrap justify-center gap-2'>
      {
        letters.map((letter) => (
          <a
            href={`#${letter}`}
            class='w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-border hover:bg-quimbara-magenta hover:text-white hover:border-quimbara-magenta transition-all font-bold text-quimbara-purple'
          >
            {letter}
          </a>
        ))
      }
    </div>
  </nav>

  <!-- Listado por Letra -->
  <div class='space-y-12'>
    {
      letters.map((letter) => (
        <section id={letter} class='scroll-mt-32'>
          <div class='flex items-center gap-4 mb-6'>
            <div class='w-16 h-16 flex items-center justify-center rounded-2xl bg-quimbara-magenta text-white font-heading font-bold text-3xl shadow-lg'>
              {letter}
            </div>
            <h2 class='text-2xl font-heading font-bold text-quimbara-purple'>
              {fightersByLetter[letter].length} peleador
              {fightersByLetter[letter].length !== 1 ? 'es' : ''}
            </h2>
          </div>

          <div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4'>
            {fightersByLetter[letter].map((fighter) => (
              <a
                href={`/peleadores/${fighter.slug}`}
                class='group flex items-center gap-4 p-4 bg-white rounded-2xl border border-border hover:border-quimbara-magenta hover:shadow-md transition-all'
              >
                <img
                  src={getFighterImg(fighter.id)}
                  alt={fighter.name}
                  class='w-16 h-16 rounded-full object-cover bg-quimbara-cream border-2 border-border group-hover:border-quimbara-magenta transition-colors'
                  loading='lazy'
                  onerror="this.src='/images/fighter-placeholder.png'"
                />
                <div class='flex-1 min-w-0'>
                  <h3 class='font-bold text-quimbara-purple group-hover:text-quimbara-magenta transition-colors truncate'>
                    {fighter.name}
                  </h3>
                  <p class='text-sm text-quimbara-purple/60'>{fighter.division}</p>
                </div>
                <svg
                  xmlns='http://www.w3.org/2000/svg'
                  width='20'
                  height='20'
                  viewBox='0 0 24 24'
                  fill='none'
                  stroke='currentColor'
                  stroke-width='2'
                  stroke-linecap='round'
                  stroke-linejoin='round'
                  class='text-quimbara-purple/30 group-hover:text-quimbara-magenta transition-colors'
                >
                  <path d='M5 12h14' />
                  <path d='m12 5 7 7-7 7' />
                </svg>
              </a>
            ))}
          </div>
        </section>
      ))
    }
  </div>

  <!-- Back to Top -->
  <div class='mt-12 text-center'>
    <a
      href='#top'
      class='inline-flex items-center gap-2 px-6 py-3 bg-quimbara-magenta text-white font-bold rounded-xl hover:bg-[#D63384] transition-all shadow-md'
    >
      <svg
        xmlns='http://www.w3.org/2000/svg'
        width='20'
        height='20'
        viewBox='0 0 24 24'
        fill='none'
        stroke='currentColor'
        stroke-width='2'
        stroke-linecap='round'
        stroke-linejoin='round'
      >
        <path d='m18 15-6-6-6 6'></path>
      </svg>
      Volver Arriba
    </a>
  </div>
</PageLayout>
