---
import events from '@/data/events-generated.json'

// Find next event
const today = new Date()
const nextEvent = events.find((e) => new Date(e.date) > today) || events[0]

if (!nextEvent) return null

// Find main fight (match names from event title)
const mainFight =
  nextEvent.fights.find((f) => {
    const eventTitle = nextEvent.name.toLowerCase()
    const fighterALastName = f.fighterA.name.split(' ').pop()?.toLowerCase() || ''
    const fighterBLastName = f.fighterB.name.split(' ').pop()?.toLowerCase() || ''

    return (
      (fighterALastName && eventTitle.includes(fighterALastName)) ||
      (fighterBLastName && eventTitle.includes(fighterBLastName))
    )
  }) || nextEvent.fights[0]
const dateObj = new Date(nextEvent.date)
const day = dateObj.getDate()
const month = dateObj.toLocaleDateString('es-ES', { month: 'short' }).toUpperCase()
const weekday = dateObj
  .toLocaleDateString('es-ES', { weekday: 'short' })
  .replace('.', '')
  .toUpperCase()

// Helper to get image URL
const getFighterImg = (id: number) => `https://media.api-sports.io/mma/fighters/${id}.png`
---

<div
  class='col-span-1 bg-white rounded-3xl p-6 flex flex-col relative overflow-hidden group shadow-lg h-full border-2 border-quimbara-magenta'
>
  <!-- Background Effect -->
  <div class='absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity'>
    <svg
      xmlns='http://www.w3.org/2000/svg'
      width='80'
      height='80'
      viewBox='0 0 24 24'
      fill='none'
      stroke='#E83C91'
      stroke-width='1.5'
      stroke-linecap='round'
      stroke-linejoin='round'
      ><rect x='3' y='4' width='18' height='18' rx='2' ry='2'></rect><line
        x1='16'
        y1='2'
        x2='16'
        y2='6'></line><line x1='8' y1='2' x2='8' y2='6'></line><line x1='3' y1='10' x2='21' y2='10'
      ></line></svg
    >
  </div>

  <div class='relative z-10 flex flex-col h-full'>
    <!-- Header -->
    <div class='flex justify-between items-start mb-4'>
      <div>
        <h4 class='font-heading text-quimbara-purple/60 text-xs uppercase tracking-widest mb-1'>
          Pr√≥ximo Evento
        </h4>
        <h3 class='font-bold text-xl leading-tight text-quimbara-purple'>
          {nextEvent.name.split(':')[0]}
        </h3>
      </div>
      <div class='text-right'>
        <div class='text-quimbara-magenta font-bold text-xl leading-none'>{day}</div>
        <div class='text-quimbara-purple/60 text-xs font-bold uppercase'>{month}</div>
      </div>
    </div>

    <!-- Main Fight Face-off -->
    <div class='flex-1 flex items-center justify-center gap-2 my-2'>
      <!-- Fighter A -->
      <a
        href={`/fighters/${mainFight.fighterA.id}`}
        class='flex flex-col items-center group/fighter w-1/2'
      >
        <div class='relative w-20 h-20 mb-2'>
          <div
            class='absolute inset-0 bg-quimbara-magenta/20 rounded-full blur-md group-hover/fighter:bg-quimbara-magenta/40 transition-all'
          >
          </div>
          <img
            src={getFighterImg(mainFight.fighterA.id)}
            alt={mainFight.fighterA.name}
            class='w-full h-full object-cover rounded-full border-2 border-quimbara-magenta bg-quimbara-purple relative z-10'
            loading='lazy'
            onerror="this.src='/images/fighter-placeholder.png'"
          />
          {
            mainFight.fighterA.rank === 'C' && (
              <span class='absolute -bottom-1 -right-1 bg-quimbara-magenta text-black text-[10px] font-bold px-1.5 py-0.5 rounded-full z-20 border border-quimbara-purple'>
                C
              </span>
            )
          }
        </div>
        <span
          class='text-xs font-bold text-center leading-tight text-quimbara-purple group-hover/fighter:text-quimbara-magenta transition-colors'
        >
          {mainFight.fighterA.name.split(' ').pop()}
        </span>
      </a>

      <div class='text-quimbara-magenta font-heading font-bold italic text-xl'>VS</div>

      <!-- Fighter B -->
      <a
        href={`/fighters/${mainFight.fighterB.id}`}
        class='flex flex-col items-center group/fighter w-1/2'
      >
        <div class='relative w-20 h-20 mb-2'>
          <div
            class='absolute inset-0 bg-quimbara-magenta/20 rounded-full blur-md group-hover/fighter:bg-quimbara-magenta/40 transition-all'
          >
          </div>
          <img
            src={getFighterImg(mainFight.fighterB.id)}
            alt={mainFight.fighterB.name}
            class='w-full h-full object-cover rounded-full border-2 border-quimbara-purple/20 bg-quimbara-cream relative z-10 group-hover/fighter:border-quimbara-magenta transition-colors'
            loading='lazy'
            onerror="this.src='/images/fighter-placeholder.png'"
          />
          {
            mainFight.fighterB.rank && mainFight.fighterB.rank !== 'NR' && (
              <span class='absolute -bottom-1 -right-1 bg-quimbara-purple/20 text-quimbara-purple text-[10px] font-bold px-1.5 py-0.5 rounded-full z-20 border border-quimbara-purple'>
                #{mainFight.fighterB.rank}
              </span>
            )
          }
        </div>
        <span
          class='text-xs font-bold text-center leading-tight text-quimbara-purple group-hover/fighter:text-quimbara-magenta transition-colors'
        >
          {mainFight.fighterB.name.split(' ').pop()}
        </span>
      </a>
    </div>

    <!-- Location & CTA -->
    <div class='mt-4 text-center'>
      <div class='flex items-center justify-center gap-1 text-quimbara-purple/50 text-xs mb-3'>
        <svg
          xmlns='http://www.w3.org/2000/svg'
          width='12'
          height='12'
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          stroke-width='2'
          stroke-linecap='round'
          stroke-linejoin='round'
          ><path d='M20 10c0 6-9 13-9 13s-9-7-9-13a9 9 0 0 1 18 0z'></path><circle
            cx='12'
            cy='10'
            r='3'></circle></svg
        >
        <span class='truncate max-w-[200px]'>{nextEvent.location}</span>
      </div>
      <a
        href={`/eventos/${nextEvent.id}`}
        class='block w-full bg-quimbara-magenta hover:bg-[#D63384] text-white font-bold py-2.5 rounded-xl text-center text-sm transition-all shadow-md hover:shadow-lg hover:shadow-[#E83C91]/20'
      >
        Ver Cartelera
      </a>
    </div>
  </div>
</div>
