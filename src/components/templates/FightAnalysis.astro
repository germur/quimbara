---
interface Props {
  fighter1Id: number;
  fighter2Id: number;
}

const { fighter1Id, fighter2Id } = Astro.props;
const API_KEY = import.meta.env.MMA_API_KEY;

// Fetch both profiles in parallel
const [res1, res2] = await Promise.all([
  fetch(`https://v1.mma.api-sports.io/fighters?id=${fighter1Id}`, { headers: { 'x-apisports-key': API_KEY } }),
  fetch(`https://v1.mma.api-sports.io/fighters?id=${fighter2Id}`, { headers: { 'x-apisports-key': API_KEY } })
]);

const data1 = await res1.json();
const data2 = await res2.json();

const f1 = data1.response?.[0];
const f2 = data2.response?.[0];

if (!f1 || !f2) {
  throw new Error(`Could not fetch fighters: ${fighter1Id} or ${fighter2Id}`);
}
---

<div class="fight-analysis my-8">
  <div class="tale-of-the-tape bg-slate-900 text-white rounded-xl overflow-hidden shadow-2xl">
    <div class="header p-4 text-center bg-red-600 uppercase font-black tracking-widest">
      Tale of the Tape
    </div>
    
    <div class="grid grid-cols-3 items-center">
      {/* Fighter 1 */}
      <div class="fighter-1 p-6 text-center border-r border-slate-700">
        <div class="w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden border-4 border-blue-500 bg-slate-800">
          <img src={f1.photo} alt={f1.name} class="w-full h-full object-cover" />
        </div>
        <h3 class="text-xl font-bold leading-tight">{f1.name}</h3>
        <p class="text-sm text-slate-400">"{f1.nickname}"</p>
      </div>

      {/* Stats Comparison */}
      <div class="stats flex flex-col gap-2 p-4 text-center text-sm">
        <div class="stat-row grid grid-cols-3 gap-2 border-b border-slate-800 pb-1">
          <span class="font-bold text-blue-400">{f1.height}</span>
          <span class="text-slate-500 uppercase text-xs tracking-wider">Altura</span>
          <span class="font-bold text-red-400">{f2.height}</span>
        </div>
        <div class="stat-row grid grid-cols-3 gap-2 border-b border-slate-800 pb-1">
          <span class="font-bold text-blue-400">{f1.weight}</span>
          <span class="text-slate-500 uppercase text-xs tracking-wider">Peso</span>
          <span class="font-bold text-red-400">{f2.weight}</span>
        </div>
        <div class="stat-row grid grid-cols-3 gap-2 border-b border-slate-800 pb-1">
          <span class="font-bold text-blue-400">{f1.reach}</span>
          <span class="text-slate-500 uppercase text-xs tracking-wider">Alcance</span>
          <span class="font-bold text-red-400">{f2.reach}</span>
        </div>
        <div class="stat-row grid grid-cols-3 gap-2">
          <span class="font-bold text-blue-400">{f1.stance}</span>
          <span class="text-slate-500 uppercase text-xs tracking-wider">Guardia</span>
          <span class="font-bold text-red-400">{f2.stance}</span>
        </div>
      </div>

      {/* Fighter 2 */}
      <div class="fighter-2 p-6 text-center border-l border-slate-700">
        <div class="w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden border-4 border-red-500 bg-slate-800">
          <img src={f2.photo} alt={f2.name} class="w-full h-full object-cover" />
        </div>
        <h3 class="text-xl font-bold leading-tight">{f2.name}</h3>
        <p class="text-sm text-slate-400">"{f2.nickname}"</p>
      </div>
    </div>
  </div>

  <div class="analysis-content mt-8 prose prose-lg dark:prose-invert mx-auto">
    <slot />
  </div>
</div>
